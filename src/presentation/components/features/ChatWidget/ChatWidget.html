<div class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
    <!-- Chat Window -->
    <transition enter-active-class="transition duration-300 ease-out" enter-from-class="translate-y-10 opacity-0"
        enter-to-class="translate-y-0 opacity-100" leave-active-class="transition duration-200 ease-in"
        leave-from-class="translate-y-0 opacity-100" leave-to-class="translate-y-10 opacity-0">
        <div v-if="isChatOpen"
            class="bg-lightNavy border border-lightestNavy shadow-2xl rounded-lg w-[320px] md:w-[380px] h-[450px] mb-4 flex flex-col">
            <!-- Chat Header -->
            <div class="flex justify-between items-center p-4 border-b border-lightestNavy bg-lightNavy">
                <div class="flex items-center gap-2">
                    <Sparkles class="w-5 h-5 text-green" />
                    <h3 class="font-bold text-white">{{ $t('chat.title') }}</h3>
                </div>
                <button @click="$emit('toggle-chat')" class="text-slate hover:text-white transition-colors">
                    <X class="w-5 h-5" />
                </button>
            </div>

            <!-- Messages -->
            <div ref="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-3 text-xs md:text-sm">
                <div v-for="(msg, i) in chatMessages" :key="i" class="p-3 rounded-lg max-w-[85%] break-words" :class="msg.sender === 'user' 
            ? 'self-end bg-green/10 text-green border border-green/30 rounded-br-none ml-auto' 
            : 'self-start bg-navy border border-lightestNavy text-slate rounded-tl-none mr-auto'">
                    <div v-if="msg.sender === 'ai'" v-html="msg.text"></div>
                    <div v-else>{{ msg.text }}</div>
                </div>

                <!-- Typing Indicator -->
                <div v-if="isThinking"
                    class="self-start bg-navy border border-lightestNavy p-4 rounded-lg rounded-tl-none flex gap-1 w-fit">
                    <div class="typing-dot w-1.5 h-1.5 bg-slate rounded-full"></div>
                    <div class="typing-dot w-1.5 h-1.5 bg-slate rounded-full"></div>
                    <div class="typing-dot w-1.5 h-1.5 bg-slate rounded-full"></div>
                </div>
            </div>

            <!-- Input -->
            <div class="p-3 bg-navy rounded-b-lg border-t border-lightestNavy">
                <form @submit.prevent="$emit('send-message')" class="flex gap-2">
                    <input :value="userInput" @input="$emit('update:userInput', $event.target.value)"
                        :disabled="isThinking" type="text" :placeholder="$t('chat.placeholder')"
                        class="flex-1 bg-lightNavy border border-lightestNavy text-white text-xs rounded px-3 py-2 focus:outline-none focus:border-green transition-colors disabled:opacity-50">
                    <button type="submit" :disabled="!userInput || isThinking"
                        class="bg-green/10 text-green border border-green p-2 rounded hover:bg-green/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        <Send class="w-3 h-3" />
                    </button>
                </form>
            </div>
        </div>
    </transition>

    <!-- Toggle Button -->
    <button @click="$emit('toggle-chat')"
        class="bg-green text-navy p-3 rounded-full shadow-lg hover:scale-110 transition-transform duration-300 shadow-neon flex items-center justify-center">
        <Sparkles v-if="!isChatOpen" class="w-6 h-6" />
        <X v-else class="w-6 h-6" />
    </button>
</div>